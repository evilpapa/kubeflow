# Kubeflow 接入管理 API

Kubeflow 接入管理 API 提供了用户空间等级接入控制细粒度。
目标是支持多租户 kubeflow 集群 / 服务。

## 管理中的资源

### 配置 Profile
- Profile 包含指向k8s用户的所有者。
- Profile 将创建一个同名的命名空间，并使配置文件所有者成为命名空间所有者。
- Profile 将创建必要的k8s资源，使所有者能够在多租户模式下访问kubeflow服务。
- 创建名称空间后，所有者可以使用API或直接创建RBAC角色和绑定来授予其他用户或组访问权限。
- 删除 Profile 将删除此配置文件拥有的命名空间和其他k8s资源。

### 绑定 Binding
- Binding 包含一个用户-空间对。
- Binding 将允许用户对引用的命名空间进行编辑访问。
- 删除 binding 将撤消用户在绑定中的访问权限。


## 用例
#### 用例 1: Kubeflow 自助

Kubeflow 管理员希望授予一组用户创建/删除可以在其中使用 Kubeflow 的命名空间的能力。生成的命名空间应该只能由创建它的用户访问；或他们授予访问权限的人。
RBAC 不直接支持这一点。因此，我们在 RBAC 之上提供了一项服务，该服务将根据用户的身份强制执行此操作

#### 用例 2: 允许用户升级 / 分享资源

我们不会授予用户编辑集群范围 CRD 资源的权限。然后，为了使用户能够编辑自己的资源，
我们提供了更新/共享/删除 API，并对每个即将到来的请求进行权限检查。

## APIs

#####`/v1/profiles`
* `create`: 创建新 profile 
  * 新用户自助注册时调用。

#####`/v1/profiles/{profile}`
* `delete`: 删除个人资料；
  * 当管理员或所有者删除配置文件/命名空间时调用。

#####`/v1/bindings`
* `create`: 创建新的绑定；
  * 当管理员或所有者与其他用户共享命名空间访问权限时调用。
* `get`: 获取绑定；
  * 查询绑定状态时调用。
  * 按用户过滤 user=... | namespace=... | role=owner/editor 查询与用户/命名空间相关的权限。
  * 例如，当需要列出用户 "abc@def.com" 的命名空间时使用 "user=abc@def.com" 进行过滤；当需要为用户列出命名空间时调用（在笔记本生成器上为当前用户列出命名空间）
  * 例如，当需要列出命名空间 "abc" 的用户列表时使用 "namespace=abc" 进行过滤；当需要列出命名空间 "abc" 的用户时调用。
* `delete`: 删除绑定；
  * 当管理员或所有者撤销命名空间访问时调用。
